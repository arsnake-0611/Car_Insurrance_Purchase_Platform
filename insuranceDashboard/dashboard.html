<html><head><base href="."><meta charset="utf-8">
    <title>Insurance Quotation Management System</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
    body {
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, sans-serif;
        background-color: #f5f8fa;
        padding: 20px;
    }
    
    /* Update sidebar styles */
    .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
        width: 220px; /* Reduced from 250px */
        background: linear-gradient(145deg, #2c3e50, #34495e);
        color: white;
        padding: 20px;
        box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
        z-index: 1000;
    }
    
    /* Sidebar Header */
    .sidebar-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 20px;
    }
    
    .sidebar-header img {
        margin-bottom: 5px;
    }
    
    .sidebar-header h3 {
        margin: 0;
        text-align: center;
        font-size: 1.2rem;
        color: white;
    }
    
    /* Update header styles */
    header {
        position: fixed;
        top: 0;
        right: 0;
        left: 220px;
        height: auto;
        min-height: 70px;
        background-color: white;
        padding: 20px 30px;
        display: flex;
        align-items: center;
        justify-content: center;  /* Center the content */
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        z-index: 100;
        transition: left 0.3s ease;
    }
    
    .header-content {
        width: 100%;
        max-width: 1200px;
        display: flex;
        flex-direction: column;  /* Stack elements vertically */
        align-items: center;     /* Center horizontally */
        gap: 10px;              /* Space between elements */
    }
    
    .header-content h2 {
        margin: 0;
        font-size: 1.8rem; /* Updated font size */
        color: #2c3e50;
        text-align: center;
        font-weight: 600; /* Updated font weight */
        line-height: 1.4; /* Updated line height */
    }
    
    .user-info {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #666;
    }
    
    .content-wrapper {
        max-width: 1000px;
        margin: 0 auto;
        padding: 30px;
        padding-top: 120px; /* Increased padding-top to prevent header overlap */
        margin-left: 220px;
        padding-bottom: 40px;
        transition: all 0.3s ease;
        background-color: #ffffff; /* Added white background */
        box-shadow: 0 0 20px rgba(0,0,0,0.05); /* Added subtle shadow */
        border-radius: 12px; /* Added rounded corners */
        min-height: calc(100vh - 140px); /* Ensure minimum height */
    }
    
    /* Add page title styles */
    .page-title {
        text-align: center;
        margin-bottom: 1.5rem;
    }
    
    /* Add search and filter container styles */
    .search-filter-container {
        margin-bottom: 1.5rem;
    }
    
    .search-filter-container .row {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    /* Quotation card styles */
    .quotation-card {
        transition: all 0.3s ease;
        border-radius: 12px;
        padding: 25px;
        max-width: 100%;
        margin: 0 0 30px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        background: linear-gradient(to bottom right, #ffffff, #f8f9fa);
        border: 1px solid #eaeaea; /* Added border */
    }
    
    .quotation-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    
    /* Quotation actions styles */
    .quotation-actions {
        display: flex;
        gap: 12px;
        position: absolute;
        top: 25px; /* Updated top positioning */
        right: 25px; /* Updated right positioning */
    }
    
    .action-buttons {
        display: flex;
        gap: 15px; /* Updated gap */
        align-items: center;
        justify-content: flex-end;
        margin-top: 20px; /* Updated top margin */
    }
    
    .quotation-status {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 500;
        text-transform: uppercase;
        font-size: 0.8em;
        letter-spacing: 0.5px;
    }
    
    .quotation-status--pending {
        background-color: #ffd700;
        color: #000;
    }
    
    .quotation-status--approved {
        background-color: #90EE90;
        color: #000;
    }
    
    .quotation-status--rejected {
        background-color: #ffcccb;
        color: #000;
    }
    
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px;
        border-radius: 5px;
        background-color: #4CAF50;
        color: white;
        display: none;
        z-index: 1000;
    }
    
    .search-box {
        border-radius: 25px;
        padding: 12px 20px;
        border: 2px solid #e0e0e0;
        transition: all 0.3s ease;
        margin-bottom: 20px;
        width: 100%;
        background-color: #ffffff; /* Added white background */
    }
    
    .search-box:focus {
        border-color: #2c3e50;
        box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.1);
    }
    
    .filter-section {
        background: #ffffff; /* Updated background */
        border-radius: 12px;
        padding: 25px; /* Increased padding */
        margin-bottom: 30px; /* Increased margin */
        box-shadow: 0 4px 12px rgba(0,0,0,0.08); /* Added shadow */
        border: 1px solid #eaeaea; /* Added border */
    }
    
    .quote-list {
        max-height: 600px;
        overflow-y: auto;
    }
    
    #quotationForm {
        display: grid;
        gap: 50px;  /* Increased gap between sections */
        padding: 40px;  /* Increased padding */
        background: white;
        border-radius: 20px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        margin-top: 30px; /* Increased margin top */
    }
    
    #quotationForm .row {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 25px; /* Increased gap between form elements */
        margin: 0;
    }
    
    .form-group {
        margin-bottom: 30px; /* Increased spacing between form groups */
    }
    
    .form-group label {
        display: block;
        margin-bottom: 12px; /* Increased label spacing */
        font-weight: 500;
        color: #2c3e50;
        font-size: 15px;
    }
    
    .details-section {
        display: none;
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .editable-field {
        margin-bottom: 15px;
    }
    
    .editable-field label {
        display: block;
        font-weight: 500;
        margin-bottom: 5px;
        color: #666;
    }
    
    .edit-field {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        transition: all 0.3s ease;
        background: #ffffff;
        font-size: 15px;
    }
    
    .edit-field:focus {
        border-color: #3e502c; /* Complementary color */
        box-shadow: 0 0 0 3px rgba(62, 80, 44, 0.1);
    }
    
    .edit-buttons {
        margin-top: 15px;
        display: flex;
        gap: 12px;
        justify-content: flex-end;
    }
    
    .sidebar-menu {
        list-style: none;
        padding: 0;
        margin-top: 30px;
    }
    
    .sidebar-menu li {
        margin-bottom: 15px;
    }
    
    .sidebar-menu a {
        color: white;
        text-decoration: none;
        display: block;
        padding: 12px 15px;
        margin: 5px 0;
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    
    .sidebar-menu a:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateX(5px);
    }
    
    .reference-number {
        font-family: monospace;
        color: #666;
        font-size: 0.9em;
    }
    
    .sidebar-bottom {
        position: absolute;
        bottom: 20px;
        left: 20px;
        right: 20px;
    }
    
    .sign-out-btn {
        width: 100%;
        padding: 10px;
        background-color: #e74c3c;
        border: none;
        border-radius: 5px;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    
    .sign-out-btn:hover {
        background-color: #c0392b;
    }
    
    /* Custom CSS classes */
    .container {
        width: 100%;
        max-width: 900px; /* Reduced max-width for better readability */
        margin: 0 auto;
        padding: 0;
    }
    
    .row {
        display: flex;
        flex-wrap: wrap;
        margin: -15px; /* Increased negative margin for better spacing */
    }
    
    .col-md-4, .col-md-6, .col-md-8 {
        padding: 10px; /* Reduced padding */
        box-sizing: border-box;
    }
    
    .col-md-4 {
        width: 33.333333%;
    }
    
    .col-md-6 {
        width: 50%;
    }
    
    .col-md-8 {
        width: 66.666667%;
    }
    
    .btn {
        border-radius: 8px;
        padding: 10px 20px;
        font-weight: 500;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .btn-primary {
        background-color: #007bff;
        color: white;
    }
    
    .btn-secondary {
        background-color: #6c757d;
        color: white;
    }
    
    .btn-success {
        background-color: #28a745;
        color: white;
    }
    
    .btn-danger {
        background-color: #dc3545;
        color: white;
    }
    
    .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .btn-sm {
        padding: 5px 10px;
        font-size: 12px;
    }
    
    .form-control {
        border-radius: 8px;
        padding: 10px 15px;
        border: 2px solid #e0e0e0;
        transition: all 0.3s ease;
        margin-bottom: 15px; /* Updated margin */
    }
    
    .form-control:focus {
        border-color: #2c3e50;
        box-shadow: 0 0 0 3px rgba(44,62,80,0.1);
    }
    
    .table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
        background-color: #ffffff; /* Updated background */
        border-radius: 8px; /* Updated border radius */
        overflow: hidden; /* Added overflow hidden */
    }
    
    .table th, .table td {
        padding: 12px 15px; /* Updated padding */
        border: 1px solid #dee2e6;
    }
    
    .table th {
        background-color: #f8f9fa;
        color: #2c3e50;
        font-weight: 600;
        padding: 15px; /* Updated padding */
    }
    
    .text-right {
        text-align: right;
    }
    
    .view-details {
        float: none;
        margin-top: 0;
        margin-right: 10px;
    }
    
    .chatbox {
        position: fixed;
        bottom: 40px;
        right: 40px;
        width: 500px;  /* Keep increased width */
        height: 700px; /* Keep increased height */
        background: #ffffff;
        border-radius: 20px;
        box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        z-index: 1000;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transform: translateY(120%);
        transition: transform 0.3s ease-in-out;
    }
    
    .chat-header {
        background: linear-gradient(145deg, #2c3e50, #502c3e); /* Primary + Triadic color */
        padding: 20px;
        color: white;
        font-weight: 600;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .chat-messages {
        flex-grow: 1;
        padding: 25px; /* Increased padding */
        overflow-y: auto;
        max-height: calc(100% - 120px);
        display: flex;
        flex-direction: column;
        background: #f8f9fa;
        scrollbar-width: thin;
        scrollbar-color: #2c3e50 #f8f9fa;
    }
    
    /* Add custom scrollbar styling */
    .chat-messages::-webkit-scrollbar {
        width: 8px;
    }
    
    .chat-messages::-webkit-scrollbar-track {
        background: #f8f9fa;
    }
    
    .chat-messages::-webkit-scrollbar-thumb {
        background-color: #2c3e50;
        border-radius: 4px;
    }
    
    .message-container {
        overflow: hidden;
        margin-bottom: 10px;
        width: 100%;
    }
    
    .message {
        border-radius: 18px;
        margin: 20px 0;
        padding: 18px;
        max-width: 95%;
        font-size: 15px;
        line-height: 1.6;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .customer-message {
        background: linear-gradient(145deg, #f8f9fa, #e9ecef);
        color: #2c3e50;
    }
    
    .staff-message {
        background: linear-gradient(145deg, #3e502c, #2c3e50); /* Analogous colors */
        color: white;
    }
    
    .message-info {
        font-size: 0.9em; /* Slightly larger */
        margin-bottom: 5px; /* More spacing */
    }
    
    .staff-message .message-info {
        text-align: right;
        color: #ccc;
    }
    
    .chat-input {
        padding: 15px;
        background: white;
        border-top: 1px solid #eee;
        display: flex;
        gap: 10px;
    }
    
    .chat-input input {
        flex: 1;
        padding: 12px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 25px;
        outline: none;
    }
    
    .chat-input button {
        padding: 12px 25px;
        background: linear-gradient(145deg, #3e502c, #2c3e50);
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .chat-input button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
            width: 180px; /* Reduced from 200px */
        }
        
        .sidebar.active {
            transform: translateX(0);
        }
        
        header {
            left: 0;
            padding: 0 60px; /* Make room for hamburger menu */
        }
        
        .content-wrapper {
            margin-left: 0;
            padding-top: 70px; /* Updated padding */
        }
    
        .header-content h2 {
            font-size: 1.2rem;
        }
        
        .user-info {
            font-size: 0.9rem;
        }
        
        .hamburger-menu {
            display: block;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    }
    
    @media (max-width: 480px) {
        header {
            height: 50px;
        }
        
        .header-content h2 {
            font-size: 1rem;
        }
        
        .user-info {
            font-size: 0.8rem;
        }
        
        .sidebar {
            width: 160px; /* Reduced from 180px */
        }
        
        .sidebar-menu a {
            padding: 8px 12px;
            font-size: 0.9rem;
        }
    }
    
    /* Update hamburger menu styles */
    .hamburger-menu {
        display: none;
        cursor: pointer;
        padding: 12px;
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 1001;
        border-radius: 5px;
        transition: all 0.3s ease;
    }
    
    .hamburger-menu:hover {
        background-color: rgba(0,0,0,0.05);
    }
    
    .hamburger-menu div {
        width: 20px;
        height: 2px;
        background-color: #333;
        margin: 4px 0;
        transition: 0.3s;
    }
    
    /* Add animation for hamburger menu when sidebar is active */
    .sidebar.active + header .hamburger-menu div:nth-child(1) {
        transform: rotate(-45deg) translate(-5px, 6px);
    }
    
    .sidebar.active + header .hamburger-menu div:nth-child(2) {
        opacity: 0;
    }
    
    .sidebar.active + header .hamburger-menu div:nth-child(3) {
        transform: rotate(45deg) translate(-5px, -6px);
    }
    
    /* Modal styles */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1050;
    }
    
    .modal.show {
        display: block;
    }
    
    .modal-dialog {
        position: relative;
        width: 90%;
        max-width: 800px;
        margin: 1.75rem auto;
    }
    
    .modal-content {
        background: linear-gradient(to bottom right, #ffffff, #f8f9fa);
        border-radius: 20px;
        padding: 60px;
        margin: 40px;
        box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        position: relative;
    }
    
    .modal-header {
        padding: 0 0 35px 0;
        margin-bottom: 40px;
        border-bottom: 2px solid rgba(44, 62, 80, 0.1);
    }
    
    .modal-header h5 {
        font-size: 24px;
        color: #2c3e50;
        font-weight: 600;
        text-align: center;
    }
    
    /* Add close button styles */
    .modal-close {
        position: absolute;
        right: 30px;
        top: 30px;
        width: 40px;
        height: 40px;
        background: #f8f9fa;
        border: 2px solid rgba(44, 62, 80, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: #2c3e50;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .modal-close:hover {
        background: #e9ecef;
        transform: rotate(90deg);
        border-color: #2c3e50;
    }
    
    /* Add section transitions */
    .form-section {
        transition: all 0.4s ease;
    }
    
    .form-section.hidden {
        opacity: 0;
        transform: translateX(-20px);
    }
    
    .form-section.visible {
        opacity: 1;
        transform: translateX(0);
    }
    
    /* Enhance form controls */
    .form-control {
        width: 100%;
        padding: 15px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 15px;
        transition: all 0.3s ease;
        background: #f8f9fa;
    }
    
    .form-control:focus {
        border-color: #3e502c;
        box-shadow: 0 0 0 4px rgba(62, 80, 44, 0.1);
        background: #ffffff;
    }
    
    /* Improve button styling */
    #nextButton, .submit-btn {
        background: linear-gradient(145deg, #2c3e50, #3e502c);
        color: white;
        padding: 15px 35px;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    #nextButton:hover, .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }
    
    /* Add required field indicator */
    .form-group label.required:after {
        content: " *";
        color: #502c3e;
    }
    
    /* Enhanced modified indicator */
    .modified-indicator {
        color: #502c3e; /* Triadic color */
        font-size: 0.9em;
        margin-left: 10px;
        padding: 4px 8px;
        border-radius: 15px;
        background: rgba(80, 44, 62, 0.1);
    }
    
    /* Enhanced edit buttons */
    .edit-buttons {
        margin-top: 15px;
        display: flex;
        gap: 12px;
        justify-content: flex-end;
    }
    
    .save-edit {
        background: linear-gradient(145deg, #2c3e50, #3e502c); /* Primary + Analogous */
        color: white;
        border: none;
    }
    
    .cancel-edit {
        background: linear-gradient(145deg, #f8f9fa, #e9ecef);
        color: #2c3e50;
        border: 1px solid #dee2e6;
    }
    </style>
    </head>
    <body>
    <div class="notification" id="notification"></div>
    <div class="hamburger-menu">
        <div></div>
        <div></div>
        <div></div>
    </div>
    
    <div class="sidebar">
        <div class="sidebar-header">
            <img alt="insurance company icon, minimalist design" src="../icon.png" width="30" height="30">
            <h3>Insurance Portal</h3>
        </div>
        <ul class="sidebar-menu">
            <li><a href="#quotations">Quotations</a></li>
            <li><a href="#settings">Settings</a></li>
            <li><a href="#reports">Reports</a></li>
        </ul>
        <div class="sidebar-bottom">
            <button class="sign-out-btn">Sign Out</button>
        </div>
    </div>
    
    <header>
        <div class="header-content">
            <h2>Insurance Quotation Management</h2>
            <div class="user-info">
                <span>Welcome, Admin</span>
            </div>
        </div>
    </header>
    
    <div class="content-wrapper">
        <h1 class="page-title">Insurance Quotation Management System</h1>
        
        <div class="search-filter-container">
            <div class="row">
                <div class="col-md-6">
                    <input type="text" id="searchQuote" class="form-control search-box" placeholder="Search quotations...">
                </div>
                <div class="col-md-6" style="text-align: right;">
                    <button class="btn btn-primary" onclick="showModal('newQuoteModal')">
                        New Quotation
                    </button>
                </div>
            </div>
        </div>
    
        <!-- Filter Section -->
        <div class="filter-section">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Date Range</label>
                    <select class="form-control" id="dateRangeFilter" required>
                        <option value="">All Time</option>
                        <option value="day">Last 24 Hours</option>
                        <option value="week">Last Week</option>
                        <option value="month">Last Month</option>
                    </select>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Status</label>
                    <select class="form-control" id="statusFilter" required>
                        <option value="">All</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Coverage Type</label>
                    <select class="form-control" id="coverageTypeFilter">
                        <option value="">All</option>
                        <option value="comprehensive">Comprehensive Coverage</option>
                        <option value="thirdParty">Third-Party Coverage</option>
                    </select>
                </div>
            </div>
        </div>
    
        <div class="row">
            <div class="col-md-8">
                <div class="quote-list" id="quoteList">
                    <!-- Quotes will be dynamically loaded here -->
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="dashboard-card">
                    <h3>Quick Statistics</h3>
                    <div style="margin-top: 1rem;">
                        <p>Total Quotations: <span id="totalQuotes">0</span></p>
                        <p>Pending: <span id="pendingQuotes">0</span></p>
                        <p>Approved: <span id="approvedQuotes">0</span></p>
                        <p>Rejected: <span id="rejectedQuotes">0</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- New Quotation Modal -->
    <div class="modal" id="newQuoteModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">New Quotation Request</h5>
                    <button type="button" class="modal-close" onclick="closeModal('newQuoteModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="quotationForm">
                        <div id="vehicleSection" class="form-section visible">
                            <h2>Vehicle Information</h2>
                            <div class="form-group">
                                <label for="vehicleMake">Vehicle Brand Name: *</label>
                                <select id="vehicleMake" name="vehicleMake" required>
                                    <option value="">Select Brand</option>
                                    <option value="Audi">Audi</option>
                                    <option value="BMW">BMW</option>
                                    <option value="Ford">Ford</option>
                                    <option value="Porsche">Porsche</option>
                                    <option value="Toyota">Toyota</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="vehicleModel">Vehicle Model: *</label>
                                <select id="vehicleModel" name="vehicleModel" required>
                                    <option value="">Select Model</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="vehicleYear">Manufacturing Year: *</label>
                                <input type="number" id="vehicleYear" name="vehicleYear" 
                                    min="2000" max="2024" maxlength="4" required
                                    pattern="[0-9]{4}" placeholder="YYYY" 
                                    title="Enter a 4-digit year between 2000 and 2024" />
                            </div>
                            <div class="form-group">
                                <label for="bodyType">Body Type: *</label>
                                <select id="bodyType" name="bodyType" required>
                                    <option value="">Select Body Type</option>
                                    <option value="Saloon">Saloon</option>
                                    <option value="Hatchback">Hatchback</option>
                                    <option value="SUV">SUV</option>
                                    <option value="Coupe">Coupe</option>
                                    <option value="Convertible">Convertible</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="seatingCapacity">Seating Capacity: *</label>
                                <input type="number" id="seatingCapacity" name="seatingCapacity" 
                                    min="2" max="9" required pattern="[2-9]"
                                    title="Enter a number between 2 and 9" />
                            </div>
                            <div class="form-group">
                                <label for="cylinderCapacity">Cylinder Capacity (C.C.): *</label>
                                <input type="number" id="cylinderCapacity" name="cylinderCapacity" 
                                    min="500" max="8000" step="100" required
                                    pattern="[5-8][0-9]{2}0" 
                                    title="Enter cylinder capacity between 500-8000 CC" />
                            </div>
                            <div class="form-group">
                                <label for="vehicleValue">Estimated Vehicle Value (HK$): *</label>
                                <input type="number" id="vehicleValue" name="vehicleValue" 
                                    min="50000" step="1000" required />
                            </div>
                            <div class="action-buttons">
                                <button type="button" id="nextButton">Next</button>
                            </div>
                        </div>
                        <div id="personalSection" class="form-section hidden">
                            <h2>Personal Information</h2>
                            <div class="form-group">
                                <label for="fullName">Full Name: *</label>
                                <input type="text" id="fullName" name="fullName" required />
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address: *</label>
                                <input type="email" id="email" name="email" required />
                            </div>
                            <div class="form-group">
                                <label for="phoneNumber">Phone Number: *</label>
                                <input type="text" id="phoneNumber" name="phoneNumber" 
                                    required pattern="[0-9]{8}" maxlength="8" 
                                    title="Please enter exactly 8 digits" />
                            </div>
                            <div class="form-group">
                                <label for="drivingExperience">Driving Experience (years): *</label>
                                <input type="number" id="drivingExperience" name="drivingExperience" 
                                    min="1" max="70" required />
                            </div>
                            <div class="form-group">
                                <label for="coveragePlan">Select Coverage Plan: *</label>
                                <select id="coveragePlan" name="coveragePlan" required>
                                    <option value="">Select a plan</option>
                                    <option value="comprehensive">Comprehensive Coverage</option>
                                    <option value="thirdParty">Third-Party Coverage</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="paymentMethod">Select Preferred Payment Method: *</label>
                                <select id="paymentMethod" name="paymentMethod" required>
                                    <option value="">Select a method</option>
                                    <option value="BankTransfer">Bank Transfer</option>
                                    <option value="CreditCard">Credit Card</option>
                                </select>
                            </div>
                            <div class="submit-container">
                                <button type="submit" id="submitQuotation" class="submit-btn">Submit Quotation</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <div class="chatbox">
        <div class="chat-header">
            <h4>Customer Support</h4>
            <button class="close-chat">Ã—</button>
        </div>
        <div class="chat-messages">
            <div class="message-container">
                <div class="message customer-message">
                    <div class="message-info">Customer</div>
                    Hello, I need help with my insurance quote.
                </div>
            </div>
            <div class="message-container">
                <div class="message staff-message">
                    <div class="message-info">Support Staff</div>
                    Welcome! How can I assist you with your insurance quote today?
                </div>
            </div>
        </div>
        <div class="chat-input">
            <input type="text" placeholder="Type your message...">
            <button>Send</button>
        </div>
    </div>
    
    <script>
    var quotes = [];
    const carModels = {
      Audi: ['A3', 'A4', 'A6', 'Q3', 'Q5', 'Q7'],
      BMW: ['1 Series', '3 Series', '5 Series', 'X1', 'X3', 'X5'],
      Ford: ['Focus', 'Fiesta', 'Mustang', 'Escape', 'Explorer'],
      Porsche: ['911', 'Cayenne', 'Macan', 'Panamera'],
      Toyota: ['Corolla', 'Camry', 'RAV4', 'Highlander', 'Land Cruiser']
    };
    
    // Show notification function
    function showNotification(message) {
        const notification = $('#notification');
        notification.text(message).fadeIn();
        setTimeout(() => notification.fadeOut(), 3000);
    }
    
    // Add required indicator to labels
    $(document).ready(function() {
        $('.form-group label').each(function() {
            const input = $(this).closest('.form-group').find('input, select');
            if (input.prop('required')) {
                $(this).addClass('required');
            }
        });
    
        // Smooth scroll to form errors
        $('.form-control').on('invalid', function(e) {
            e.preventDefault();
            const $this = $(this);
            $this.closest('.form-group').addClass('has-error');
            
            $('html, body').animate({
                scrollTop: $this.offset().top - 100
            }, 500);
        });
    
        // Remove error state on input
        $('.form-control').on('input', function() {
            $(this).closest('.form-group').removeClass('has-error');
        });
    
        // Enhance form navigation
        $('#nextButton').click(function() {
            if (validateSection('vehicleSection')) {
                $('#vehicleSection').removeClass('visible').addClass('hidden');
                setTimeout(() => {
                    $('#personalSection').removeClass('hidden').addClass('visible');
                }, 300);
            }
        });
    });
    
    function validateSection(sectionId) {
        const section = $(`#${sectionId}`);
        const inputs = section.find('input, select');
        let isValid = true;
        
        inputs.each(function() {
            if (!this.checkValidity()) {
                isValid = false;
                $(this).closest('.form-group').addClass('has-error');
            }
        });
        
        if (!isValid) {
            showNotification('Please fill all required fields');
        }
        
        return isValid;
    }
    
    // Update vehicle make change handler
    $('#vehicleMake').on('change', function() {
      const selectedMake = $(this).val();
      const modelSelect = $('#vehicleModel');
      modelSelect.empty().append('<option value="">Select Model</option>');
      
      if (selectedMake) {
        carModels[selectedMake].forEach(model => {
          modelSelect.append(`<option value="${model}">${model}</option>`);
        });
      }
    });
    
    // Update phone number validation
    $('#phoneNumber').on('input', function() {
        // Remove non-digits
        let value = this.value.replace(/\D/g, '');
        
        // Limit to 8 digits
        if (value.length > 8) {
            value = value.substr(0, 8);
        }
        
        // Update input value
        this.value = value;
    });
    
    // Add phone validation to quotation form
    $('#quotationForm').find('input[name="phoneNumber"]').attr({
        'pattern': '[0-9]{8}',
        'maxlength': '8',
        'title': 'Please enter exactly 8 digits',
        'oninvalid': 'this.setCustomValidity("Phone number must be exactly 8 digits")',
        'oninput': 'this.setCustomValidity("")'
    });
    
    function showModal(modalId) {
        document.getElementById(modalId).classList.add('show');
    }
    
    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.remove('show');
        // Reset form when closing
        document.getElementById('quotationForm').reset();
        // Reset sections visibility
        document.getElementById('vehicleSection').classList.add('visible');
        document.getElementById('vehicleSection').classList.remove('hidden');
        document.getElementById('personalSection').classList.remove('visible');
        document.getElementById('personalSection').classList.add('hidden');
    }
    
    // Close modal when clicking outside
    window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
            event.target.classList.remove('show');
        }
    }
    $(document).ready(function() {
        // Move the showNotification function inside document.ready
        function showNotification(message) {
            const notification = $('#notification');
            notification.text(message).fadeIn();
            setTimeout(() => notification.fadeOut(), 3000);
        }
    
        let quotes = [
            {
                id: 1,
                referenceNumber: 'QT2023001',
                vehicleMake: "Toyota",
                vehicleModel: "Camry",
                vehicleYear: 2020,
                bodyType: "Sedan",
                seatingCapacity: 5,
                cylinderCapacity: 2000,
                vehicleValue: 200000,
                fullName: "John Doe",
                email: "john@example.com",
                phoneNumber: "12345678", // Updated for validity
                drivingExperience: 5,
                coveragePlan: "comprehensive",
                paymentMethod: "creditCard",
                status: "pending",
                date: new Date().toISOString().split('T')[0] // Today
            },
            {
                id: 2,
                referenceNumber: 'QT2023002',
                vehicleMake: "Honda",
                vehicleModel: "Civic",
                vehicleYear: 2019,
                bodyType: "Sedan",
                seatingCapacity: 5,
                cylinderCapacity: 1800,
                vehicleValue: 150000,
                fullName: "Jane Smith",
                email: "jane@example.com",
                phoneNumber: "09876543", // Updated for validity
                drivingExperience: 3,
                coveragePlan: "thirdParty",
                paymentMethod: "bankTransfer",
                status: "approved",
                statusDate: new Date().toISOString(), // Added status change date
                date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 3 days ago
            },
            {
                id: 3,
                referenceNumber: 'QT2023003',
                vehicleMake: "Ford",
                vehicleModel: "Focus",
                vehicleYear: 2018,
                bodyType: "Hatchback",
                seatingCapacity: 5,
                cylinderCapacity: 1600,
                vehicleValue: 90000,
                fullName: "Alice Johnson",
                email: "alice@example.com",
                phoneNumber: "11223344", // Updated for validity
                drivingExperience: 4,
                coveragePlan: "comprehensive",
                paymentMethod: "creditCard",
                status: "rejected",
                statusDate: new Date().toISOString(), // Added status change date
                date: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 10 days ago
            },
            {
                id: 4,
                referenceNumber: 'QT2023004',
                vehicleMake: "BMW",
                vehicleModel: "X5",
                vehicleYear: 2021,
                bodyType: "SUV",
                seatingCapacity: 5,
                cylinderCapacity: 3000,
                vehicleValue: 600000,
                fullName: "Bob Brown",
                email: "bob@example.com",
                phoneNumber: "22334455", // Updated for validity
                drivingExperience: 6,
                coveragePlan: "comprehensive",
                paymentMethod: "bankTransfer",
                status: "pending",
                date: new Date(Date.now() - 25 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 25 days ago
            }
        ];
    
        function displayQuotes(quotesToShow = quotes) {
            const quoteList = $('#quoteList');
            quoteList.empty();
    
            quotesToShow.forEach((quote, index) => {
                const quoteCard = $(`
                    <div class="quotation-card" style="opacity: 0; transform: translateY(20px);">
                        <span class="quotation-reference">Ref: ${quote.referenceNumber}</span>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <p>Vehicle: ${quote.vehicleMake} ${quote.vehicleModel}</p>
                                <p>Date: ${quote.date}</p>
                                <p>Coverage: ${quote.coveragePlan === 'comprehensive' ? 'Comprehensive Coverage' : 'Third-Party Coverage'}</p>
                                <span class="quotation-status quotation-status--${quote.status}">${quote.status.toUpperCase()}</span>
                            </div>
                        </div>
    
                        <div class="action-buttons">
                            <button class="btn btn-secondary btn-sm view-details" data-id="${quote.id}">View Details</button>
                            <button class="btn support-button btn-sm">
                                <span class="support-icon">ðŸ’¬</span>Support Chat
                            </button>
                        </div>
                        
                        <div class="details-section" id="details-${quote.id}">
                            <table class="table">
                                <tr>
                                    <th colspan="2">Insurance Information</th>
                                </tr>
                                <tr>
                                    <td>Coverage Type:</td>
                                    <td>${quote.coveragePlan === 'comprehensive' ? 'Comprehensive Coverage' : 'Third-Party Coverage'}</td>
                                </tr>
                                <tr>
                                    <th colspan="2">Vehicle Information</th>
                                </tr>
                                <tr>
                                    <td>Manufacturing Year:</td>
                                    <td>${quote.vehicleYear}</td>
                                </tr>
                                <tr>
                                    <td>Body Type:</td>
                                    <td>${quote.bodyType}</td>
                                </tr>
                                <tr>
                                    <td>Seating Capacity:</td>
                                    <td>${quote.seatingCapacity}</td>
                                </tr>
                                <tr>
                                    <td>Cylinder Capacity:</td>
                                    <td>${quote.cylinderCapacity}</td>
                                </tr>
                                <tr>
                                    <td>Vehicle Value (HK$):</td>
                                    <td>${quote.vehicleValue}</td>
                                </tr>
                                <tr>
                                    <th colspan="2">Personal Information</th>
                                </tr>
                                <tr>
                                    <td>Full Name:</td>
                                    <td>${quote.fullName}</td>
                                </tr>
                                <tr>
                                    <td>Phone:</td>
                                    <td>${quote.phoneNumber}</td>
                                </tr>
                                <tr>
                                    <td>Email:</td>
                                    <td>${quote.email}</td>
                                </tr>
                                <tr>
                                    <td>Driving Experience:</td>
                                    <td>${quote.drivingExperience} years</td>
                                </tr>
                                <tr>
                                    <td>Payment Method:</td>
                                    <td>${quote.paymentMethod}</td>
                                </tr>
                            </table>
                            ${quote.status === 'pending' ? `
                                <div class="approval-actions" style="text-align: right; margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                                    <button class="btn btn-danger btn-sm reject-quote" data-id="${quote.id}">Reject</button>
                                    <button class="btn btn-success btn-sm approve-quote" data-id="${quote.id}">Approve</button>
                                    <button class="btn btn-primary edit-quote" data-id="${quote.id}">Edit</button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `);
                
                quoteList.append(quoteCard);
                
                // Animate each card with a slight delay
                setTimeout(() => {
                    quoteCard.css({
                        'transition': 'all 0.5s ease',
                        'opacity': '1',
                        'transform': 'translateY(0)'
                    });
                }, index * 100);
            });
    
            updateStatistics();
        }
    
        $(document).on('click', '.view-details', function() {
            const id = $(this).data('id');
            $(`#details-${id}`).slideToggle();
        });
    
        $('#searchQuote').on('input', function() {
            const searchTerm = $(this).val().toLowerCase();
            filterQuotes();
        });
    
        function filterQuotes() {
            const searchTerm = $('#searchQuote').val().toLowerCase();
            const dateRange = $('#dateRangeFilter').val();
            const status = $('#statusFilter').val();
            const coverageType = $('#coverageTypeFilter').val(); // New filter
    
            const filteredQuotes = quotes.filter(quote => {
                // Search criteria
                const searchMatches = 
                    quote.fullName.toLowerCase().includes(searchTerm) ||
                    quote.vehicleMake.toLowerCase().includes(searchTerm) ||
                    quote.vehicleModel.toLowerCase().includes(searchTerm) ||
                    quote.email.toLowerCase().includes(searchTerm) ||
                    quote.referenceNumber.toLowerCase().includes(searchTerm);
    
                // Date range criteria
                const quoteDate = new Date(quote.date);
                const now = new Date();
                let dateMatches = true;
    
                if (dateRange) {
                    switch(dateRange) {
                        case 'day':
                            dateMatches = (now - quoteDate) <= (24 * 60 * 60 * 1000);
                            break;
                        case 'week':
                            dateMatches = (now - quoteDate) <= (7 * 24 * 60 * 60 * 1000);
                            break;
                        case 'month':
                            dateMatches = (now - quoteDate) <= (30 * 24 * 60 * 60 * 1000);
                            break;
                    }
                }
    
                // Status and coverage type criteria
                const statusMatches = !status || quote.status === status;
                const coverageMatches = !coverageType || quote.coveragePlan === coverageType;
    
                return searchMatches && dateMatches && statusMatches && coverageMatches;
            });
    
            displayQuotes(filteredQuotes);
        }
    
        $('#dateRangeFilter, #statusFilter, #coverageTypeFilter').on('change', function() {
            filterQuotes();
        });
    
        $('#quotationForm').on('submit', function(e) {
            e.preventDefault();
            
            if (!this.checkValidity()) {
                showNotification('Please fill all required fields');
                return;
            }
    
            // Create new quote object
            const newQuote = {
                id: quotes.length + 1,
                referenceNumber: `QT${new Date().getFullYear()}${(quotes.length + 1).toString().padStart(3, '0')}`,
                vehicleMake: $('#vehicleMake').val(),
                vehicleModel: $('#vehicleModel').val(),
                vehicleYear: parseInt($('#vehicleYear').val()),
                bodyType: $('#bodyType').val(),
                seatingCapacity: parseInt($('#seatingCapacity').val()),
                cylinderCapacity: parseInt($('#cylinderCapacity').val()),
                vehicleValue: parseInt($('#vehicleValue').val()),
                fullName: $('#fullName').val(),
                email: $('#email').val(),
                phoneNumber: $('#phoneNumber').val(),
                drivingExperience: parseInt($('#drivingExperience').val()),
                coveragePlan: $('#coveragePlan').val(),
                paymentMethod: $('#paymentMethod').val(),
                status: 'pending',
                date: new Date().toISOString().split('T')[0]
            };
    
            // Add quote and update display
            quotes.unshift(newQuote);
            displayQuotes();
            updateStatistics();
            
            // Show confirmation
            showNotification('Quote submitted successfully!');
            
            // Reset form and close modal
            this.reset();
            closeModal('newQuoteModal');
        });
    
        // Handle edit button click
        $(document).on('click', '.edit-quote', function(e) {
            e.preventDefault();
            const id = $(this).data('id');
            const detailsSection = $(`#details-${id}`);
            const quote = quotes.find(q => q.id === id);
            
            // Auto-fill payment method
            const paymentMethodField = detailsSection.find('select[class="edit-field"]').filter(function() {
                return $(this).closest('tr').find('td:first').text().trim().toLowerCase() === 'payment method:';
            });
            if (paymentMethodField.length) {
                paymentMethodField.val(quote.paymentMethod);
            }
    
            // Replace table data cells with appropriate input types
            const table = detailsSection.find('table');
            table.find('tr').each(function() {
                const row = $(this);
                // Skip header rows
                if (row.find('th').length > 0) {
                    return;
                }
                
                const label = row.find('td:first-child').text().trim().toLowerCase();
                const dataCell = row.find('td:nth-child(2)');
                const currentValue = dataCell.text().trim();
                
                let input;
                
                switch(label) {
                    case 'coverage type:':
                        input = $('<select>')
                            .attr('class', 'edit-field')
                            .append('<option value="comprehensive">Comprehensive Coverage</option>')
                            .append('<option value="thirdParty">Third-Party Coverage</option>');
                        input.val(currentValue.toLowerCase().includes('comprehensive') ? 'comprehensive' : 'thirdParty');
                        break;
                        
                    case 'manufacturing year:':
                        input = $('<input>')
                            .attr('type', 'number')
                            .attr('class', 'edit-field')
                            .attr('min', '2000')
                            .attr('max', '2024')
                            .attr('value', currentValue);
                        break;
                        
                    case 'body type:':
                        input = $('<select>')
                            .attr('class', 'edit-field')
                            .append('<option value="Saloon">Saloon</option>')
                            .append('<option value="Hatchback">Hatchback</option>')
                            .append('<option value="SUV">SUV</option>')
                            .append('<option value="Coupe">Coupe</option>')
                            .append('<option value="Convertible">Convertible</option>');
                        input.val(currentValue);
                        break;
                        
                    case 'seating capacity:':
                        input = $('<input>')
                            .attr('type', 'number')
                            .attr('class', 'edit-field')
                            .attr('min', '2')
                            .attr('max', '9')
                            .attr('value', currentValue.replace(' years', ''));
                        break;
                        
                    case 'cylinder capacity:':
                        input = $('<input>')
                            .attr('type', 'number')
                            .attr('class', 'edit-field')
                            .attr('min', '500')
                            .attr('max', '8000')
                            .attr('step', '100')
                            .attr('value', currentValue);
                        break;
                        
                    case 'vehicle value (hk$):':
                        input = $('<input>')
                            .attr('type', 'number')
                            .attr('class', 'edit-field')
                            .attr('min', '50000')
                            .attr('step', '1000')
                            .attr('value', currentValue);
                        break;
                        
                    case 'full name:':
                        input = $('<input>')
                            .attr('type', 'text')
                            .attr('class', 'edit-field')
                            .attr('value', currentValue);
                        break;
                        
                    case 'phone:':
                        input = $('<input>')
                            .attr('type', 'text')
                            .attr('class', 'edit-field')
                            .attr('value', currentValue);
                        break;
                        
                    case 'email:':
                        input = $('<input>')
                            .attr('type', 'email')
                            .attr('class', 'edit-field')
                            .attr('value', currentValue);
                        break;
                        
                    case 'driving experience:':
                        input = $('<input>')
                            .attr('type', 'number')
                            .attr('class', 'edit-field')
                            .attr('min', '1')
                            .attr('max', '70')
                            .attr('value', currentValue.replace(' years', ''));
                        break;
                        
                    case 'payment method:':
                        input = $('<select>')
                            .attr('class', 'edit-field')
                            .append('<option value="BankTransfer">Bank Transfer</option>')
                            .append('<option value="CreditCard">Credit Card</option>');
                        input.val(currentValue.replace(' ', ''));
                        break;
                        
                    default:
                        input = $('<input>')
                            .attr('type', 'text')
                            .attr('class', 'edit-field')
                            .attr('value', currentValue);
                }
                
                // Add a modified indicator
                const modifiedIndicator = $('<span>')
                    .addClass('modified-indicator')
                    .css({
                        'color': '#ff6b6b',
                        'font-size': '0.8em',
                        'margin-left': '8px',
                        'display': 'none'
                    })
                    .text('(modified)');
                
                const container = $('<div>')
                    .css({
                        'display': 'flex',
                        'align-items': 'center',
                        'width': '100%'
                    })
                    .append(input)
                    .append(modifiedIndicator);
                    
                dataCell.html(container);
                
                // Add change event to show modified indicator
                input.on('input change', function() {
                    modifiedIndicator.show();
                });
            });
            
            // Replace approval buttons with save/cancel buttons
            const actionButtons = detailsSection.find('.approval-actions');
            actionButtons.html(`
                <button class="btn btn-secondary btn-sm cancel-edit" data-id="${id}">Cancel</button>
                <button class="btn btn-primary btn-sm save-edit" data-id="${id}">Save Changes</button>
            `);
        });
    
        $(document).on('click', '.cancel-edit', function() {
            const id = $(this).data('id');
            displayQuotes(); // Reset to original display
        });
    
        $(document).on('click', '.save-edit', function() {
            const id = $(this).data('id');
            const detailsSection = $(`#details-${id}`);
            const quoteIndex = quotes.findIndex(q => q.id === id);
            const originalQuote = { ...quotes[quoteIndex] };
            let changes = [];
    
            if (quoteIndex === -1) {
                showNotification('Error: Quote not found');
                return;
            }
    
            let updatedQuote = { ...quotes[quoteIndex] };
    
            try {
                // Gather all edited values
                detailsSection.find('.edit-field').each(function() {
                    const field = $(this);
                    const row = field.closest('tr');
                    const fieldName = row.find('td:first').text().trim().toLowerCase().replace(':', '');
                    const newValue = field.val();
                    let oldValue;
    
                    switch(fieldName) {
                        case 'coverage type':
                            oldValue = originalQuote.coveragePlan;
                            if (oldValue !== newValue) {
                                changes.push({ field: 'Coverage Type', from: oldValue, to: newValue });
                            }
                            updatedQuote.coveragePlan = newValue;
                            break;
                        case 'manufacturing year': 
                            oldValue = originalQuote.vehicleYear.toString();
                            if (oldValue !== newValue) {
                                changes.push({ field: 'Manufacturing Year', from: oldValue, to: newValue });
                            }
                            updatedQuote.vehicleYear = parseInt(newValue);
                            break;
                        case 'body type':
                            oldValue = originalQuote.bodyType;
                            if (oldValue !== newValue) {
                                changes.push({ field: 'Body Type', from: oldValue, to: newValue });
                            }
                            updatedQuote.bodyType = newValue;
                            break;
                        case 'seating capacity':
                            oldValue = originalQuote.seatingCapacity.toString();
                            if (oldValue !== newValue) {
                                changes.push({ field: 'Seating Capacity', from: oldValue, to: newValue });
                            }
                            updatedQuote.seatingCapacity = parseInt(newValue);
                            break;
                        case 'cylinder capacity':
                            oldValue = originalQuote.cylinderCapacity.toString();
                            if (oldValue !== newValue) {
                                changes.push({ field: 'Cylinder Capacity', from: oldValue, to: newValue });
                            }
                            updatedQuote.cylinderCapacity = parseInt(newValue);
                            break;
                        case 'vehicle value (hk$)':
                            oldValue = originalQuote.vehicleValue.toString();
                            if (oldValue !== newValue) {
                                changes.push({ field: 'Vehicle Value', from: oldValue, to: newValue });
                            }
                            updatedQuote.vehicleValue = parseInt(newValue);
                            break;
                        case 'full name':
                            oldValue = originalQuote.fullName;
                            if (oldValue !== newValue) {
                                changes.push({ field: 'Full Name', from: oldValue, to: newValue });
                            }
                            updatedQuote.fullName = newValue;
                            break;
                        case 'phone':
                            oldValue = originalQuote.phoneNumber;
                            if (oldValue !== newValue) {
                                changes.push({ field: 'Phone', from: oldValue, to: newValue });
                            }
                            updatedQuote.phoneNumber = newValue;
                            break;
                        case 'email':
                            oldValue = originalQuote.email;
                            if (oldValue !== newValue) {
                                changes.push({ field: 'Email', from: oldValue, to: newValue });
                            }
                            updatedQuote.email = newValue;
                            break;
                        case 'driving experience':
                            oldValue = originalQuote.drivingExperience.toString();
                            if (oldValue !== newValue) {
                                changes.push({ field: 'Driving Experience', from: oldValue, to: newValue });
                            }
                            updatedQuote.drivingExperience = parseInt(newValue);
                            break;
                        case 'payment method':
                            oldValue = originalQuote.paymentMethod;
                            if (oldValue !== newValue) {
                                changes.push({ field: 'Payment Method', from: oldValue, to: newValue });
                            }
                            updatedQuote.paymentMethod = newValue;
                            break;
                    }
                });
    
                // Update quote and show changes
                quotes[quoteIndex] = updatedQuote;
                displayQuotes();
                
                if (changes.length > 0) {
                    showChangesInChat(changes, updatedQuote);
                }
                
                showNotification('Changes saved successfully!');
    
            } catch (error) {
                console.error('Error saving changes:', error);
                showNotification('Error saving changes. Please try again.');
            }
        });
    
        // Update showChangesInChat function to remove customer reply simulation
        function showChangesInChat(changes, quote) {
            const timestamp = new Date().toLocaleString();
            const changeMessage = changes.map(change => 
                `â€¢ ${change.field}: "${change.from}" â†’ "${change.to}"`
            ).join('\n');
    
            // Add staff update message only
            $('.chat-messages').append(`
                <div class="message-container">
                    <div class="message staff-message">
                        <div class="message-info">Support Staff (${timestamp})</div>
                        Hello ${quote.fullName}, I wanted to inform you that we've updated your insurance quote (${quote.referenceNumber}). Here are the changes that have been made:
                        <br><br>
                        ${changeMessage.split('\n').join('<br>')}
                        <br><br>
                        If you have any questions about these changes, please don't hesitate to ask.
                    </div>
                </div>
            `);
            
            $('.chat-messages').scrollTop($('.chat-messages')[0].scrollHeight);
        }
    
        $(document).on('click', '.approve-quote', function() {
            const id = $(this).data('id');
            const quote = quotes.find(q => q.id === id);
            quote.status = 'approved';
            quote.statusDate = new Date().toISOString(); // Add status change date
            displayQuotes();
            showNotification('Quote approved successfully!');
        });
    
        $(document).on('click', '.reject-quote', function() {
            const id = $(this).data('id');
            const quote = quotes.find(q => q.id === id);
            quote.status = 'rejected';
            quote.statusDate = new Date().toISOString(); // Add status change date
            displayQuotes();
            showNotification('Quote rejected successfully!');
        });
    
        $(document).on('click', '.edit-quote', function() {
            window.location.hash = '#quotations';
        });
    
        $(window).on('hashchange', function() {
            if(window.location.hash === '#quotations') {
                $('.main-content').show();
            } else if(window.location.hash === '#dashboard') {
                $('.main-content').hide();
            }
        });
    
        // Update statistics display with animation
        function updateStatistics() {
            const stats = {
                total: quotes.length,
                pending: quotes.filter(q => q.status === 'pending').length,
                approved: quotes.filter(q => q.status === 'approved').length,
                rejected: quotes.filter(q => q.status === 'rejected').length
            };
            
            // Animate statistics update
            ['total', 'pending', 'approved', 'rejected'].forEach(stat => {
                const element = $(`#${stat}Quotes`);
                const currentValue = parseInt(element.text());
                const newValue = stats[stat];
                
                $({value: currentValue}).animate({value: newValue}, {
                    duration: 1000,
                    easing: 'swing',
                    step: function() {
                        element.text(Math.floor(this.value));
                    },
                    complete: function() {
                        element.text(newValue);
                    }
                });
            });
        }
    
        $('.sign-out-btn').on('click', function() {
            if(confirm('Are you sure you want to sign out?')) {
                window.location.href = "https://example.com/login"; // Replace with actual login page URL
            }
        });
    
        // Hamburger menu functionality
        $('.hamburger-menu').click(function(e) {
            e.stopPropagation();
            $('.sidebar').toggleClass('active');
            $(this).toggleClass('active');
        });
    
        // Close sidebar when clicking outside on mobile
        $(document).click(function(event) {
            if ($(window).width() <= 768) {
                if (!$(event.target).closest('.sidebar').length && 
                    !$(event.target).closest('.hamburger-menu').length) {
                    $('.sidebar').removeClass('active');
                    $('.hamburger-menu').removeClass('active');
                }
            }
        });
    
        // Handle window resize
        let resizeTimer;
        $(window).resize(function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                if ($(window).width() > 768) {
                    $('.sidebar').removeClass('active');
                    $('.hamburger-menu').removeClass('active');
                }
            }, 250);
        });
    
        // Chat support functionality
        $(document).on('click', '.support-button', function() {
            $('.chatbox').css('transform', 'translateY(0)');
        });
    
        $('.close-chat').click(function() {
            $('.chatbox').css('transform', 'translateY(120%)');
        });
    
        $('.chat-input button').click(sendMessage);
        $('.chat-input input').keypress(function(e) {
            if (e.which == 13) {
                sendMessage();
            }
        });
    
        function sendMessage() {
            const input = $('.chat-input input');
            const message = input.val().trim();
            
            if (message !== '') {
                const timestamp = new Date().toLocaleTimeString();
                
                // Add staff message only
                $('.chat-messages').append(`
                    <div class="message-container">
                        <div class="message staff-message">
                            <div class="message-info">Support Staff (${timestamp})</div>
                            Thank you for your message. How can I assist you today?
                        </div>
                    </div>
                `);
                
                input.val('');
                $('.chat-messages').scrollTop($('.chat-messages')[0].scrollHeight);
            }
        }
    
        displayQuotes();
    });
    
    // Add this JavaScript function to handle section navigation
    function showPersonalSection() {
        $('#vehicleSection').removeClass('visible').addClass('hidden');
        setTimeout(() => {
            $('#personalSection').removeClass('hidden').addClass('visible');
        }, 300);
    }
    
    // Add event listener for the Next button
    $('#nextButton').on('click', function() {
        // Validate first section
        const vehicleSection = $('#vehicleSection');
        const inputs = vehicleSection.find('input, select');
        let isValid = true;
        
        inputs.each(function() {
            if (!this.checkValidity()) {
                isValid = false;
                $(this).addClass('invalid');
                return false;
            }
        });
        
        if (!isValid) {
            showNotification('Please fill all required fields');
            return;
        }
        
        // Show next section
        vehicleSection.removeClass('visible').addClass('hidden');
        $('#personalSection').removeClass('hidden').addClass('visible');
        
        // Add submit button if not exists
        if (!$('#submitQuotation').length) {
            $('#personalSection').append(`
                <div class="submit-container">
                    <button type="submit" id="submitQuotation" class="submit-btn">Submit Quotation</button>
                </div>
            `);
        }
    });
    
    // Update form submission
    $('#quotationForm').on('submit', function(e) {
        e.preventDefault();
        
        if (!this.checkValidity()) {
            showNotification('Please fill all required fields');
            return;
        }
        
        // Create new quote object
        const newQuote = {
            id: quotes.length + 1,
            referenceNumber: `QT${new Date().getFullYear()}${(quotes.length + 1).toString().padStart(3, '0')}`,
            vehicleMake: $('#vehicleMake').val(),
            vehicleModel: $('#vehicleModel').val(),
            vehicleYear: parseInt($('#vehicleYear').val()),
            bodyType: $('#bodyType').val(),
            seatingCapacity: parseInt($('#seatingCapacity').val()),
            cylinderCapacity: parseInt($('#cylinderCapacity').val()),
            vehicleValue: parseInt($('#vehicleValue').val()),
            fullName: $('#fullName').val(),
            email: $('#email').val(),
            phoneNumber: $('#phoneNumber').val(),
            drivingExperience: parseInt($('#drivingExperience').val()),
            coveragePlan: $('#coveragePlan').val(),
            paymentMethod: $('#paymentMethod').val(),
            status: 'pending',
            date: new Date().toISOString().split('T')[0]
        };
        
        // Add quote and update display
        quotes.unshift(newQuote);
        displayQuotes();
        updateStatistics();
        
        // Show confirmation
        showNotification('Quote submitted successfully!');
        
        // Reset form and close modal
        this.reset();
        closeModal('newQuoteModal');
    });
    </script>
    </body></html>